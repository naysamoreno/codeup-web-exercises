<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
<style>
    @keyframes spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
</style>
<div>Projected Forcast</div>
<div id="display"></div>
<div id='map' style='width: 600px; height: 500px;'>
</div>


<script src="js/keys.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>

<script>
"use strict"
    mapboxgl.accessToken = MAPBOX_ACCESS_TOKEN;
    var map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        center: [-98.4936, 29.4241], // starting position [lng, lat]
        zoom: 8 // starting zoom
    });

    // var coordinates = [29.4241, -98.4936];
    // // var coordinates = [];
    // $.ajax('https://api.openweathermap.org/data/2.5/onecall?units=imperial&lat=' + coordinates[0] + '&lon=' + coordinates[1] + '&appid=' + WEATHER_MAP_TOKEN)
    //     .done(function (resp) {
    //         console.log(resp);
    //         var today = resp.daily[0];
    //         var todayDate = new Date(today.dt * 1000)
    //         console.log(todayDate);
    //     });

    var dateContainer = {
        fontFamily: 'arial',
        fontsize: '20px',
        background: '#f7f7f7',
        padding: '20px 0'
    }
    var bottomBorder = {
        paddingBottom: '10px',
        borderBottom: '1px solid #dedede'
    }
    function Label(text) {
        return $('<label/>').append(text).css({ fontWeight: 'bolder' })
    }
    function Spinner(width='100px') {
        return $('<div/>').css({
            borderTop: '5px solid #0CB1C4',
            borderLeft: '5px solid #0CB1C4',
            borderRadius: '50%',
            width,
            height: width,
            animation: 'spin 0.9s linear infinite'
        })
    }
    var display = $('#display').css({display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '300px'})
    display.html(Spinner())

    $.get('https://api.openweathermap.org/data/2.5/onecall', {
        APPID: WEATHER_MAP_TOKEN,
        lat: 29.4241,
        lon: -98.4936,
        units: "imperial"
    }).done(function(resp) {
        console.log('5 day forcast', resp);

        var forecast = $('<div/>').css({display: 'flex', flexWrap: 'wrap', gap: '16px', justifyContent: 'center', margin: '16px' })
        resp.daily.forEach(function(today, index) {
            if(index >= 5) return
            var container = $('<div/>').attr({ id: 'data-' + (index + 1)}).css({
                textAlign: 'center',
                border: '1px solid #a4a4a4',
                borderRadius: '4px',
                display: 'flex',
                flexDirection: 'column',
                gap: '16px',
                width: '300px'
            })
            var {humidity, wind_speed, pressure, temp, weather, dt} = today

            forecast.append(container.append(
                $('<div/>').append(new Date(dt * 1000).toDateString()).css(dateContainer),
                $('<div/>').css(bottomBorder).append(parseInt(temp.day), 'Â°'),
                $('<div/>').css({padding: '10px'}).append(Label('Description: '), weather[0].description),
                $('<div/>').css(bottomBorder).append(Label('Humidity: '), humidity),
                $('<div/>').css(bottomBorder).append(Label('Wind: '), wind_speed),
                $('<div/>').css(bottomBorder).append(Label('Pressure: '), pressure),
            ))
        })
        display.html(forecast)
    });
</script>
</body>
</html>